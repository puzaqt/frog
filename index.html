<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’è›™è·³è·å¶ - æ‰“å­—å°æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", "Microsoft YaHei", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e6f7ff 0%, #b3e0ff 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* æ¸¸æˆæ ‡é¢˜ */
        .game-title {
            font-size: 36px;
            color: #2d6a4f;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 2px;
        }

        /* éš¾åº¦é€‰æ‹©é¢æ¿ */
        .difficulty-panel {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            touch-action: manipulation;
        }

        .difficulty-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .difficulty-btn.active {
            background: #22c55e;
            color: white;
            box-shadow: 0 3px 10px rgba(34, 197, 94, 0.4);
        }

        .difficulty-btn:not(.active) {
            background: #f1f5f9;
            color: #475569;
        }

        .difficulty-btn:not(.active):hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        /* æç¤ºæ–‡å­—åŒºåŸŸ */
        .prompt-container {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px 30px;
            border-radius: 50px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 90%;
        }

        .prompt {
            font-size: 28px;
            color: #1a5f7a;
            font-weight: bold;
            text-align: center;
        }

        /* æ¸¸æˆçŠ¶æ€æç¤º */
        .game-tip {
            font-size: 16px;
            color: #64748b;
            margin-left: 10px;
            background: rgba(96, 165, 250, 0.1);
            padding: 4px 12px;
            border-radius: 12px;
        }

        #target-chars {
            color: #dc2626;
            font-size: 32px;
            margin: 0 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .timer {
            font-size: 24px;
            color: #9333ea;
            font-weight: bold;
            background: rgba(147, 51, 234, 0.1);
padding: 5px 15px;
            border-radius: 20px;
        }

        /* è¾“å…¥ç¼“å†²åŒºæ˜¾ç¤º - å¢å¼ºè§†è§‰åé¦ˆ */
        .input-buffer {
            font-size: 26px;
            color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            padding: 8px 20px;
            border-radius: 20px;
            min-width: 150px;
            text-align: center;
            font-weight: 600;
        }

        .input-correct {
            color: #22c55e;
            font-weight: bold;
        }

        .input-pending {
            color: #9333ea;
            opacity: 0.7;
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            width: 900px;
            height: 450px;
            background: linear-gradient(180deg, #7fc8f8 0%, #4a90e2 100%);
            border: 8px solid #1a5f7a;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* æ°´é¢æ³¢çº¹æ•ˆæœ - ä¼˜åŒ–æ€§èƒ½ï¼Œé™ä½åŠ¨ç”»å¼€é”€ */
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='100' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10 Q 25 0, 50 10 T 100 10' fill='none' stroke='white' stroke-width='1' opacity='0.2'/%3E%3C/svg%3E");
            background-repeat: repeat-y;
            animation: waterWave 15s linear infinite; /* æ”¾æ…¢åŠ¨ç”»é€Ÿåº¦ï¼Œé™ä½CPUå ç”¨ */
            pointer-events: none;
            will-change: background-position;
        }

        @keyframes waterWave {
            0% { background-position: 0 0; }
            100% { background-position: 0 20px; }
        }

        /* è·å¶æ ·å¼ - ä¼˜åŒ–å°ºå¯¸å’Œé—´è·ï¼Œé¿å…é‡å  */
        .lilypad {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #4ade80 0%, #22c55e 70%, #16a34a 100%);
            border-radius: 50%;
            position: absolute;
            bottom: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 26px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: 
                0 8px 15px rgba(0,0,0,0.2),
                inset 0 -5px 10px rgba(0,0,0,0.1);
            transition: all 0.2s ease; /* åˆå¹¶è¿‡æ¸¡æ•ˆæœ */
            z-index: 5;
            will-change: transform;
        }

        /* ä¸åŒéš¾åº¦çš„è·å¶é€‚é… */
        .lilypad.easy {
            font-size: 26px;
            width: 100px;
            height: 100px;
        }

        .lilypad.medium {
            font-size: 22px;
            width: 110px;
            height: 110px;
        }

        .lilypad.hard {
            font-size: 18px;
            width: 120px;
            height: 120px;
        }

        /* è·å¶äº¤äº’åé¦ˆ */
        .lilypad:hover {
            transform: scale(1.05);
        }

        /* å½“å‰ç›®æ ‡è·å¶é«˜äº® - å¢å¼ºè§†è§‰æç¤º */
        .lilypad.active {
            transform: scale(1.1);
            box-shadow: 
                0 0 25px rgba(255, 255, 0, 0.9),
                0 8px 15px rgba(0,0,0,0.2);
            background: radial-gradient(circle, #84cc16 0%, #4ade80 70%, #22c55e 100%);
        }

        /* æ­£ç¡®è¾“å…¥åçš„è·å¶åé¦ˆ */
        .lilypad.correct {
            animation: lilypadSuccess 0.5s ease;
        }

        @keyframes lilypadSuccess {
            0% { transform: scale(1.1); }
            50% { transform: scale(1.15); box-shadow: 0 0 30px rgba(74, 222, 128, 0.8); }
            100% { transform: scale(1.1); }
        }

        /* é”™è¯¯åé¦ˆ */
        .error-feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 48px;
            color: #ef4444;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 20;
            will-change: transform, opacity;
        }

        .error-feedback.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            animation: shake 0.5s ease, fadeOut 0.5s ease 0.5s forwards;
        }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
            25% { transform: translate(-55%, -50%) scale(1) rotate(-5deg); }
            75% { transform: translate(-45%, -50%) scale(1) rotate(5deg); }
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* é’è›™æ ·å¼ - ä¼˜åŒ–å®šä½åŸºå‡† */
        .frog {
            width: 70px;
            height: 70px;
            position: absolute;
            bottom: 65px;
            left: 0; /* é‡ç½®leftä¸º0ï¼Œå®Œå…¨é€šè¿‡transformå®šä½ */
            z-index: 10;
            transform-origin: center bottom;
            will-change: transform;
        }

        /* é’è›™èº«ä½“ */
        .frog::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 60px;
            background: radial-gradient(circle, #84cc16 0%, #65a30d 100%);
            border-radius: 50% 50% 30% 30%;
            box-shadow: 
                inset -10px 0 10px rgba(0,0,0,0.1),
                0 5px 10px rgba(0,0,0,0.2);
        }

        /* é’è›™çœ¼ç› */
        .frog::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 12px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 28px 0 0 white,
                        14px 2px 0 2px black,
                        40px 2px 0 2px black;
        }

        /* é’è›™è·³è·ƒåŠ¨ç”» - ä¼˜åŒ–æ›²çº¿ï¼Œæ›´è‡ªç„¶ */
        @keyframes frogJump {
            0% { transform: translateX(var(--frog-x, 0)) translateY(0); }
            50% { transform: translateX(var(--frog-x, 0)) translateY(-30px); } /* å¢åŠ è·³è·ƒé«˜åº¦ï¼Œæ›´ç”ŸåŠ¨ */
            100% { transform: translateX(var(--frog-x, 0)) translateY(0); }
        }

        .frog.jump {
            animation: frogJump 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); /* æ›´è‡ªç„¶çš„åŠ¨ç”»æ›²çº¿ */
        }

        /* é’è›™åé€€åŠ¨ç”» */
        @keyframes frogBack {
            0% { transform: translateX(var(--frog-x, 0)) translateY(0); }
            50% { transform: translateX(var(--frog-x, 0)) translateY(-15px); }
            100% { transform: translateX(var(--frog-x, 0)) translateY(0); }
        }

        .frog.back {
            animation: frogBack 0.4s ease;
        }

        /* ç»ˆç‚¹æ ·å¼ */
        .finish-line {
            width: 25px;
            height: 350px;
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            position: absolute;
            right: 60px;
            top: 50px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        /* ç»ˆç‚¹æ——å¸œ */
        .finish-line::after {
            content: 'ğŸ†';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            animation: trophyFloat 2s ease-in-out infinite;
            will-change: transform;
        }

        @keyframes trophyFloat {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        /* å¾—åˆ†å’ŒçŠ¶æ€é¢æ¿ */
        .status-panel {
            margin-top: 20px;
            display: flex;
            gap: 30px;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            justify-content: center;
        }

        .status {
            font-size: 22px;
            color: #1a5f7a;
            font-weight: 600;
        }

        .status-value {
            color: #22c55e;
            font-size: 24px;
        }

        .error-value {
            color: #ef4444;
        }

        /* é‡ç½®æŒ‰é’® */
        .control-btn {
            margin-top: 25px;
            display: flex;
            gap: 15px;
        }

        .reset-btn {
            padding: 12px 40px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .reset-btn:hover {
            background: linear-gradient(90deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* èƒœåˆ©/å¤±è´¥å¼¹çª— */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px 60px;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.2);
            z-index: 100;
            text-align: center;
            transition: transform 0.3s ease;
            max-width: 90%;
            width: 500px;
            display: none;
        }

        .modal.active {
            transform: translate(-50%, -50%) scale(1);
            display: block;
        }

        .win-title {
            font-size: 48px;
            color: #22c55e;
            margin-bottom: 20px;
        }

        .lose-title {
            font-size: 48px;
            color: #ef4444;
            margin-bottom: 20px;
        }

        .modal-text {
            font-size: 24px;
            color: #1a5f7a;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .modal-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .modal-stat-item {
            background: #f8fafc;
            padding: 10px 20px;
            border-radius: 15px;
        }

        .modal-btn {
            padding: 12px 30px;
            font-size: 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px;
            touch-action: manipulation;
        }

        .win-btn {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .lose-btn {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* é®ç½©å±‚ */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* ========== æ–°å¢ï¼šè™šæ‹Ÿé”®ç›˜æ ·å¼ ========== */
        /* é”®ç›˜å¼€å…³æŒ‰é’® */
        .keyboard-toggle-btn {
            margin-top: 15px;
            padding: 10px 25px;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .keyboard-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* è™šæ‹Ÿé”®ç›˜å®¹å™¨ */
        .virtual-keyboard {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            max-width: 800px;
            width: 90%;
            display: none; /* é»˜è®¤éšè— */
        }

        .virtual-keyboard.show {
            display: block; /* æ˜¾ç¤ºé”®ç›˜ */
        }

        /* é”®ç›˜è¡Œ */
        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        /* é”®ç›˜æŒ‰é”® */
        .keyboard-key {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 8px;
            background: #f1f5f9;
            color: #1a5f7a;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }

        .keyboard-key:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .keyboard-key:active {
            background: #cbd5e1;
            transform: translateY(0);
        }

        /* ç‰¹æ®ŠæŒ‰é”®ï¼ˆåˆ é™¤é”®ï¼‰ */
        .keyboard-key.special {
            width: 70px;
            background: #0ea5e9;
            color: white;
        }

        .keyboard-key.special:hover {
            background: #0284c7;
        }

        /* ========== æ–°å¢ï¼šAIæ”»ç•¥åŠ©æ‰‹æ ·å¼ ========== */
        .ai-helper-container {
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            max-width: 800px;
            width: 90%;
        }

        .ai-helper-title {
            font-size: 20px;
            color: #1a5f7a;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-helper-title::before {
            content: 'ğŸ¤–';
            font-size: 24px;
        }

        .ai-helper-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            width: 100%;
        }

        #ai-helper-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            color: #1a5f7a;
            outline: none;
            transition: border-color 0.3s ease;
        }

        #ai-helper-input:focus {
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        #ai-helper-send {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #ai-helper-send:hover {
            background: linear-gradient(90deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-2px);
        }

        #ai-helper-send:active {
            transform: translateY(0);
        }

        .ai-helper-response {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            min-height: 60px;
            color: #1e293b;
            font-size: 16px;
            line-height: 1.5;
            border-left: 4px solid #0ea5e9;
        }

        .ai-helper-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #64748b;
        }

        .ai-helper-loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #0ea5e9;
            border-radius: 50%;
            animation: loading 1s linear infinite;
        }

        @keyframes loading {
            to { transform: rotate(360deg); }
        }

        /* å“åº”å¼é€‚é… - ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ */
        @media (max-width: 950px) {
            .game-container {
                width: 90%;
            }
            .lilypad {
                transform: scale(0.9);
            }
            .prompt-container {
                gap: 10px;
                padding: 15px;
            }
            .keyboard-key {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            .keyboard-key.special {
                width: 60px;
            }
            .ai-helper-input-container {
                flex-direction: column;
            }
        }

        @media (max-width: 600px) {
            .status-panel {
                gap: 15px;
            }
            .status {
                font-size: 18px;
            }
            .status-value {
                font-size: 20px;
            }
            .game-title {
                font-size: 28px;
            }
            .prompt {
                font-size: 22px;
            }
            #target-chars {
                font-size: 26px;
            }
            .timer, .input-buffer {
                font-size: 20px;
                padding: 5px 10px;
            }
            .lilypad {
                transform: scale(0.8);
            }
            /* ç§»åŠ¨ç«¯ä¼˜åŒ–é’è›™å°ºå¯¸ */
            .frog {
                width: 60px;
                height: 60px;
            }
            .frog::before {
                width: 60px;
                height: 50px;
            }
            /* ç§»åŠ¨ç«¯ä¼˜åŒ–é”®ç›˜æŒ‰é”® */
            .keyboard-key {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            .keyboard-key.special {
                width: 50px;
            }
        }

        /* ç¡¬ä»¶åŠ é€Ÿ - åªç»™éœ€è¦åŠ¨ç”»çš„å…ƒç´ æ·»åŠ  */
        .animate-target {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
    </style>
</head>
<body>
    <h1 class="game-title">ğŸ¸ é’è›™è·³è·å¶ æ‰“å­—å°æ¸¸æˆ ğŸ¸</h1>
    
    <!-- éš¾åº¦é€‰æ‹© -->
    <div class="difficulty-panel">
        <button class="difficulty-btn active" data-level="easy">ç®€å• (2å­—ç¬¦)</button>
        <button class="difficulty-btn" data-level="medium">ä¸­ç­‰ (3å­—ç¬¦)</button>
        <button class="difficulty-btn" data-level="hard">å›°éš¾ (4å­—ç¬¦)</button>
    </div>

    <div class="prompt-container">
        <div class="prompt">è¯·æ•²å‡»é”®ç›˜è¾“å…¥ï¼š<span id="target-chars">AB</span>
            <span class="game-tip" id="game-tip">æŒ‰å¯¹åº”å­—ç¬¦å¼€å§‹æ¸¸æˆ</span>
        </div>
        <div class="timer">è®¡æ—¶ï¼š<span id="time-display">00:00</span></div>
        <div class="input-buffer" id="input-buffer">
            <span class="input-correct" id="input-correct"></span>
            <span class="input-pending" id="input-pending">_</span>
        </div>
    </div>

    <div class="game-container" id="game-container">
        <div class="frog animate-target" id="frog"></div>
        <div class="finish-line animate-target"></div>
        <div class="error-feedback animate-target" id="error-feedback">âŒ</div>
    </div>

    <div class="status-panel">
        <div class="status">è¿›åº¦ï¼š<span id="step-count" class="status-value">0</span> / <span id="total-steps" class="status-value">0</span></div>
        <div class="status">æ­£ç¡®ç‡ï¼š<span id="accuracy" class="status-value">100</span>%</div>
        <div class="status">é”™è¯¯æ¬¡æ•°ï¼š<span id="error-count" class="status-value error-value">0</span></div>
        <div class="status">é€Ÿåº¦ï¼š<span id="speed" class="status-value">0</span> å­—ç¬¦/åˆ†é’Ÿ</div>
    </div>

    <div class="control-btn">
        <button class="reset-btn" id="reset-btn">é‡æ–°å¼€å§‹æ¸¸æˆ</button>
    </div>

    <!-- ========== æ–°å¢ï¼šè™šæ‹Ÿé”®ç›˜ç›¸å…³å…ƒç´  ========== -->
    <button class="keyboard-toggle-btn" id="keyboard-toggle-btn">ğŸ“± æ˜¾ç¤ºè™šæ‹Ÿé”®ç›˜</button>
    <div class="virtual-keyboard" id="virtual-keyboard">
        <div class="keyboard-row">
            <button class="keyboard-key">1</button>
            <button class="keyboard-key">2</button>
            <button class="keyboard-key">3</button>
            <button class="keyboard-key">4</button>
            <button class="keyboard-key">5</button>
            <button class="keyboard-key">6</button>
            <button class="keyboard-key">7</button>
            <button class="keyboard-key">8</button>
            <button class="keyboard-key">9</button>
            <button class="keyboard-key">0</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-key">Q</button>
            <button class="keyboard-key">W</button>
            <button class="keyboard-key">E</button>
            <button class="keyboard-key">R</button>
            <button class="keyboard-key">T</button>
            <button class="keyboard-key">Y</button>
            <button class="keyboard-key">U</button>
            <button class="keyboard-key">I</button>
            <button class="keyboard-key">O</button>
            <button class="keyboard-key">P</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-key">A</button>
            <button class="keyboard-key">S</button>
            <button class="keyboard-key">D</button>
            <button class="keyboard-key">F</button>
            <button class="keyboard-key">G</button>
            <button class="keyboard-key">H</button>
            <button class="keyboard-key">J</button>
            <button class="keyboard-key">K</button>
            <button class="keyboard-key">L</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-key">Z</button>
            <button class="keyboard-key">X</button>
            <button class="keyboard-key">C</button>
            <button class="keyboard-key">V</button>
            <button class="keyboard-key">B</button>
            <button class="keyboard-key">N</button>
            <button class="keyboard-key">M</button>
            <button class="keyboard-key special" id="keyboard-backspace">åˆ é™¤</button>
        </div>
        <div class="keyboard-row">
            <button class="keyboard-key">!</button>
            <button class="keyboard-key">@</button>
            <button class="keyboard-key">#</button>
            <button class="keyboard-key">$</button>
            <button class="keyboard-key">%</button>
            <button class="keyboard-key">^</button>
            <button class="keyboard-key">&</button>
            <button class="keyboard-key">*</button>
            <button class="keyboard-key">(</button>
            <button class="keyboard-key">)</button>
        </div>
    </div>

    <!-- ========== æ–°å¢ï¼šAIæ”»ç•¥åŠ©æ‰‹ ========== -->
    <div class="ai-helper-container">
        <div class="ai-helper-title">æ¸¸æˆæ”»ç•¥åŠ©æ‰‹</div>
        <div class="ai-helper-input-container">
            <input type="text" id="ai-helper-input" placeholder="è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„ï¼Ÿæ¯”å¦‚ï¼šæ¸¸æˆæ€ä¹ˆç©ï¼Ÿå¦‚ä½•æé«˜æ­£ç¡®ç‡ï¼Ÿ" />
            <button id="ai-helper-send">å‘é€</button>
        </div>
        <div class="ai-helper-response" id="ai-helper-response">
            ä½ å¥½ï¼æˆ‘æ˜¯æ¸¸æˆæ”»ç•¥åŠ©æ‰‹ï¼Œæœ‰ä»»ä½•å…³äºæ¸¸æˆçš„é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘å“¦ï½
        </div>
    </div>

    <!-- èƒœåˆ©å¼¹çª— -->
    <div class="overlay" id="overlay"></div>
    <div class="modal animate-target" id="win-modal">
        <div class="win-title">ğŸ‰ æ­å–œèƒœåˆ©ï¼ ğŸ‰</div>
        <div class="modal-text">é’è›™æˆåŠŸåˆ°è¾¾ç»ˆç‚¹ï¼</div>
        <div class="modal-stats">
            <div class="modal-stat-item">ç”¨æ—¶ï¼š<span id="final-time">00:00</span></div>
            <div class="modal-stat-item">æ­£ç¡®ç‡ï¼š<span id="final-accuracy">100</span>%</div>
            <div class="modal-stat-item">é€Ÿåº¦ï¼š<span id="final-speed">0</span> å­—ç¬¦/åˆ†é’Ÿ</div>
        </div>
        <button class="modal-btn win-btn" id="win-btn">å†æ¥ä¸€å±€</button>
    </div>

    <!-- å¤±è´¥å¼¹çª— -->
    <div class="modal animate-target" id="lose-modal">
        <div class="lose-title">ğŸ˜ æŒ‘æˆ˜å¤±è´¥ï¼ ğŸ˜</div>
        <div class="modal-text">é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œé’è›™æ‰æ°´é‡Œäº†ï¼</div>
        <div class="modal-stats">
            <div class="modal-stat-item">ç”¨æ—¶ï¼š<span id="lose-time">00:00</span></div>
            <div class="modal-stat-item">é”™è¯¯æ¬¡æ•°ï¼š<span id="lose-errors">0</span></div>
            <div class="modal-stat-item">å®Œæˆè¿›åº¦ï¼š<span id="lose-progress">0</span>%</div>
        </div>
        <button class="modal-btn lose-btn" id="lose-btn">é‡æ–°æŒ‘æˆ˜</button>
    </div>

    <script>
        // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨requestAnimationFrameï¼Œé¿å…setInterval
        const requestAnimFrame = window.requestAnimationFrame || 
            window.webkitRequestAnimationFrame || 
            window.mozRequestAnimationFrame || 
            (cb => setTimeout(cb, 16));

        const cancelAnimFrame = window.cancelAnimationFrame || 
            window.webkitCancelAnimationFrame || 
            window.mozCancelAnimationFrame || 
            clearTimeout;

        // æ¸¸æˆæ ¸å¿ƒå˜é‡ - ç¼“å­˜å¸¸ç”¨DOMå…ƒç´ 
        const domCache = {
            gameContainer: document.getElementById('game-container'),
            frog: document.getElementById('frog'),
            targetCharsEl: document.getElementById('target-chars'),
            stepCountEl: document.getElementById('step-count'),
            totalStepsEl: document.getElementById('total-steps'),
            accuracyEl: document.getElementById('accuracy'),
            errorCountEl: document.getElementById('error-count'),
            speedEl: document.getElementById('speed'),
            timeDisplayEl: document.getElementById('time-display'),
            resetBtn: document.getElementById('reset-btn'),
            errorFeedback: document.getElementById('error-feedback'),
            difficultyBtns: document.querySelectorAll('.difficulty-btn'),
            inputCorrectEl: document.getElementById('input-correct'),
            inputPendingEl: document.getElementById('input-pending'),
            gameTip: document.getElementById('game-tip'),
            overlay: document.getElementById('overlay'),
            winModal: document.getElementById('win-modal'),
            loseModal: document.getElementById('lose-modal'),
            winBtn: document.getElementById('win-btn'),
            loseBtn: document.getElementById('lose-btn'),
            finalTimeEl: document.getElementById('final-time'),
            finalAccuracyEl: document.getElementById('final-accuracy'),
            finalSpeedEl: document.getElementById('final-speed'),
            loseTimeEl: document.getElementById('lose-time'),
            loseErrorsEl: document.getElementById('lose-errors'),
            loseProgressEl: document.getElementById('lose-progress'),
            // ========== æ–°å¢ï¼šè™šæ‹Ÿé”®ç›˜ç›¸å…³DOMç¼“å­˜ ==========
            keyboardToggleBtn: document.getElementById('keyboard-toggle-btn'),
            virtualKeyboard: document.getElementById('virtual-keyboard'),
            keyboardBackspace: document.getElementById('keyboard-backspace'),
            // ========== æ–°å¢ï¼šAIåŠ©æ‰‹ç›¸å…³DOMç¼“å­˜ ==========
            aiHelperInput: document.getElementById('ai-helper-input'),
            aiHelperSend: document.getElementById('ai-helper-send'),
            aiHelperResponse: document.getElementById('ai-helper-response')
        };

        // æ¸¸æˆé…ç½® - ä¼˜åŒ–è·å¶é—´è·ï¼Œé¿å…é‡å 
        const difficultyConfig = {
            easy: {
                lilypadCount: 6,
                lilypadGap: 120, // å¢å¤§é—´è·ï¼Œé¿å…é‡å 
                chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                maxErrors: 5,
                charLength: 2,
                speedFactor: 1
            },
            medium: {
                lilypadCount: 8,
                lilypadGap: 110, // å¢å¤§é—´è·
                chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
                maxErrors: 4,
                charLength: 3,
                speedFactor: 1.2
            },
            hard: {
                lilypadCount: 10,
                lilypadGap: 100, // å¢å¤§é—´è·
                chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=',
                maxErrors: 3,
                charLength: 4,
                speedFactor: 1.5
            }
        };

        // ========== æ–°å¢ï¼šAIæ”»ç•¥åŠ©æ‰‹å›ç­”åº“ ==========
        const aiAnswers = {
            // åŸºç¡€é—®é¢˜
            "æ¸¸æˆæ€ä¹ˆç©": "æ¸¸æˆç©æ³•å¾ˆç®€å•å“¦ï¼1. é€‰æ‹©éš¾åº¦åï¼Œè·å¶ä¸Šä¼šå‡ºç°éšæœºå­—ç¬¦ï¼›2. æŒ‰é”®ç›˜è¾“å…¥å¯¹åº”å­—ç¬¦ï¼Œè¾“å…¥æ­£ç¡®é’è›™ä¼šè·³åˆ°ä¸‹ä¸€ç‰‡è·å¶ï¼›3. è¾“å…¥é”™è¯¯ä¼šç´¯è®¡é”™è¯¯æ¬¡æ•°ï¼Œè¾¾åˆ°ä¸Šé™æ¸¸æˆå¤±è´¥ï¼›4. é’è›™è·³åˆ°ç»ˆç‚¹çº¿å³ä¸ºèƒœåˆ©ï¼",
            "æ€ä¹ˆå¼€å§‹æ¸¸æˆ": "é€‰æ‹©éš¾åº¦åï¼Œç›´æ¥æŒ‰é”®ç›˜è¾“å…¥è·å¶ä¸Šæ˜¾ç¤ºçš„å­—ç¬¦å³å¯å¼€å§‹æ¸¸æˆï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»è™šæ‹Ÿé”®ç›˜çš„æŒ‰é”®å“¦ï½",
            "æœ‰å“ªäº›éš¾åº¦": "æ¸¸æˆæœ‰ç®€å•ã€ä¸­ç­‰ã€å›°éš¾ä¸‰ä¸ªéš¾åº¦ï¼šç®€å•æ¨¡å¼æ˜¯2ä¸ªå­—ç¬¦ï¼Œ6ç‰‡è·å¶ï¼Œæœ€å¤š5æ¬¡é”™è¯¯ï¼›ä¸­ç­‰æ¨¡å¼æ˜¯3ä¸ªå­—ç¬¦ï¼Œ8ç‰‡è·å¶ï¼Œæœ€å¤š4æ¬¡é”™è¯¯ï¼›å›°éš¾æ¨¡å¼æ˜¯4ä¸ªå­—ç¬¦ï¼Œ10ç‰‡è·å¶ï¼Œæœ€å¤š3æ¬¡é”™è¯¯ã€‚",
            
            // æŠ€å·§ç±»é—®é¢˜
            "å¦‚ä½•æé«˜æ­£ç¡®ç‡": "æé«˜æ­£ç¡®ç‡çš„å°æŠ€å·§ï¼š1. å…ˆçœ‹æ¸…è·å¶ä¸Šçš„å­—ç¬¦å†è¾“å…¥ï¼Œä¸è¦ç€æ€¥ï¼›2. è¾“å…¥æ—¶ä¸“æ³¨å½“å‰å­—ç¬¦ï¼Œä¸è¦åˆ†å¿ƒæƒ³ä¸‹ä¸€ä¸ªï¼›3. é”™è¯¯è¾“å…¥åä¸è¦æ…Œï¼ŒåŠæ—¶è°ƒæ•´å¿ƒæ€ï¼›4. å¯ä»¥å…ˆä»ç®€å•æ¨¡å¼ç»ƒä¹ ï¼Œç†Ÿæ‚‰åå†æå‡éš¾åº¦ã€‚",
            "æ€ä¹ˆæé«˜æ‰“å­—é€Ÿåº¦": "æå‡æ‰“å­—é€Ÿåº¦çš„æ–¹æ³•ï¼š1. ç†Ÿæ‚‰é”®ç›˜å¸ƒå±€ï¼Œç›²æ‰“æ˜¯å…³é”®ï¼›2. å…ˆä¿è¯æ­£ç¡®ç‡ï¼Œå†æ…¢æ…¢æå‡é€Ÿåº¦ï¼›3. å¤šç»ƒä¹ ï¼Œç†Ÿæ‚‰ä¸åŒå­—ç¬¦çš„ç»„åˆï¼›4. ä¿æŒèŠ‚å¥ï¼Œä¸è¦æ—¶å¿«æ—¶æ…¢ã€‚",
            "é¿å…é”™è¯¯çš„æ–¹æ³•": "é¿å…é”™è¯¯çš„å°æŠ€å·§ï¼š1. è¾“å…¥å‰å…ˆç¡®è®¤ç›®æ ‡å­—ç¬¦ï¼›2. é€ä¸ªå­—ç¬¦è¾“å…¥ï¼Œä¸è¦ä¸€æ¬¡æ€§è¾“å…¥å¤šä¸ªï¼›3. å‘ç°è¾“å…¥é”™è¯¯åŠæ—¶æŒ‰åˆ é™¤é”®ä¿®æ­£ï¼›4. ä¿æŒæ‰‹éƒ¨æ”¾æ¾ï¼Œé¿å…å› ç´§å¼ å¯¼è‡´è¾“é”™ã€‚",
            
            // è§„åˆ™ç±»é—®é¢˜
            "é”™è¯¯æ¬¡æ•°ä¸Šé™æ˜¯å¤šå°‘": "ä¸åŒéš¾åº¦çš„é”™è¯¯ä¸Šé™ä¸åŒï¼šç®€å•æ¨¡å¼5æ¬¡ï¼Œä¸­ç­‰æ¨¡å¼4æ¬¡ï¼Œå›°éš¾æ¨¡å¼3æ¬¡ã€‚é”™è¯¯æ¬¡æ•°è¾¾åˆ°ä¸Šé™æ¸¸æˆå°±ä¼šå¤±è´¥å“¦ï¼",
            "èƒœåˆ©æ¡ä»¶æ˜¯ä»€ä¹ˆ": "å½“é’è›™è·³åˆ°ç»ˆç‚¹çº¿ï¼ˆçº¢è‰²ç«–çº¿ï¼‰ä½ç½®æ—¶ï¼Œå³ä¸ºæ¸¸æˆèƒœåˆ©ï¼ä½ éœ€è¦æ­£ç¡®è¾“å…¥æ‰€æœ‰è·å¶ä¸Šçš„å­—ç¬¦æ‰èƒ½åˆ°è¾¾ç»ˆç‚¹ã€‚",
            "é€Ÿåº¦æ€ä¹ˆè®¡ç®—": "é€Ÿåº¦æ˜¯æ ¹æ®ä½ å®Œæˆçš„å­—ç¬¦æ•°å’Œç”¨æ—¶è®¡ç®—çš„ï¼Œå…¬å¼æ˜¯ï¼šï¼ˆæ­£ç¡®è¾“å…¥å­—ç¬¦æ•° / ç”¨æ—¶åˆ†é’Ÿæ•°ï¼‰ï¼Œç”¨æ—¶è¶ŠçŸ­ã€è¾“å…¥è¶Šå‡†ç¡®ï¼Œé€Ÿåº¦å°±è¶Šé«˜ï½",
            
            // å…¶ä»–é—®é¢˜
            "è™šæ‹Ÿé”®ç›˜æ€ä¹ˆç”¨": "ç‚¹å‡»â€œæ˜¾ç¤ºè™šæ‹Ÿé”®ç›˜â€æŒ‰é’®å³å¯è°ƒå‡ºè™šæ‹Ÿé”®ç›˜ï¼Œç‚¹å‡»æŒ‰é”®å°±å¯ä»¥è¾“å…¥å­—ç¬¦ï¼Œåˆ é™¤é”®å¯ä»¥åˆ é™¤å·²è¾“å…¥çš„å­—ç¬¦ï¼Œå’ŒçœŸå®é”®ç›˜åŠŸèƒ½ä¸€æ ·å“¦ï¼",
            "é‡æ–°å¼€å§‹æ¸¸æˆ": "ç‚¹å‡»â€œé‡æ–°å¼€å§‹æ¸¸æˆâ€æŒ‰é’®å³å¯é‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä½ å¯ä»¥é€‰æ‹©æ–°çš„éš¾åº¦é‡æ–°æŒ‘æˆ˜ï½",
            "é»˜è®¤å›ç­”": "æˆ‘æ¥å¸®ä½ è§£ç­”æ¸¸æˆç›¸å…³é—®é¢˜ï½\nå¸¸è§é—®é¢˜ï¼š\n1. æ¸¸æˆæ€ä¹ˆç©ï¼Ÿ\n2. å¦‚ä½•æé«˜æ­£ç¡®ç‡ï¼Ÿ\n3. æœ‰å“ªäº›éš¾åº¦ï¼Ÿ\n4. æ€ä¹ˆæé«˜æ‰“å­—é€Ÿåº¦ï¼Ÿ"
        };

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentDifficulty: 'easy',
            config: difficultyConfig.easy,
            currentLilypadIndex: 0,
            targetChars: '',
            lilypads: [],
            totalInputs: 0,
            correctInputs: 0,
            errorCount: 0,
            gameStarted: false,
            gameTimerId: null,
            startTime: 0,
            elapsedTime: 0,
            isGameOver: false,
            inputBuffer: '',
            frogWidth: 70, // ç¼“å­˜é’è›™å®½åº¦ï¼Œé¿å…é‡å¤è®¡ç®—
            containerWidth: 900,
            lilypadShiftX: 0, // è·å¶æ•´ä½“å·¦ç§»çš„åç§»é‡
            finishLineOffset: 80, // ç»ˆç‚¹çº¿å³ä¾§é¢„ç•™ç©ºé—´ï¼ˆé¿å…é®æŒ¡ï¼‰
            // ========== æ–°å¢ï¼šè™šæ‹Ÿé”®ç›˜çŠ¶æ€ ==========
            keyboardVisible: false
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                ...gameState,
                currentLilypadIndex: 0,
                totalInputs: 0,
                correctInputs: 0,
                errorCount: 0,
                gameStarted: false,
                isGameOver: false,
                inputBuffer: '',
                gameTimerId: null,
                elapsedTime: 0,
                startTime: 0,
                containerWidth: domCache.gameContainer.offsetWidth,
                lilypadShiftX: 0 // é‡ç½®åç§»é‡
            };

            // éšè—å¼¹çª—
            domCache.winModal.classList.remove('active');
            domCache.loseModal.classList.remove('active');
            domCache.overlay.classList.remove('active');
            domCache.winModal.style.display = 'none';
            domCache.loseModal.style.display = 'none';
            domCache.overlay.style.display = 'none';

            // æ¸…ç©ºè·å¶ - æ‰¹é‡ç§»é™¤ï¼Œå‡å°‘DOMæ“ä½œ
            gameState.lilypads.forEach(lilypad => {
                if (lilypad.element && lilypad.element.parentNode) {
                    domCache.gameContainer.removeChild(lilypad.element);
                }
            });
            gameState.lilypads = [];

            // é‡ç½®UI
            domCache.errorCountEl.textContent = '0';
            domCache.accuracyEl.textContent = '100';
            domCache.speedEl.textContent = '0';
            domCache.timeDisplayEl.textContent = '00:00';
            domCache.stepCountEl.textContent = '0';
            domCache.totalStepsEl.textContent = gameState.config.lilypadCount;
            domCache.inputCorrectEl.textContent = '';
            domCache.inputPendingEl.textContent = '_';
            domCache.gameTip.textContent = 'æŒ‰å¯¹åº”å­—ç¬¦å¼€å§‹æ¸¸æˆ';

            // åˆ›å»ºè·å¶
            createLilypads();

            // è®¾ç½®åˆå§‹ç›®æ ‡å­—ç¬¦
            updateTargetChars();

            // é‡ç½®é’è›™ä½ç½® - ç²¾å‡†å®šä½åˆ°ç¬¬ä¸€ä¸ªè·å¶
            resetFrogPosition();

            // æ¸…é™¤å®šæ—¶å™¨
            if (gameState.gameTimerId) {
                cancelAnimFrame(gameState.gameTimerId);
                gameState.gameTimerId = null;
            }
        }

        // åˆ›å»ºè·å¶ - è®¡ç®—ä¸­å¿ƒåæ ‡ï¼Œç”¨äºé’è›™å®šä½ï¼Œä¸”ä¸é®æŒ¡ç»ˆç‚¹çº¿
        function createLilypads() {
            const config = gameState.config;
            // è®¡ç®—èµ·å§‹Xï¼šä¿è¯æœ€åä¸€ç‰‡è·å¶åˆ°ç»ˆç‚¹çº¿æœ‰è¶³å¤Ÿç©ºé—´
            const finishLineLeft = gameState.containerWidth - gameState.finishLineOffset;
            const totalLilypadWidth = (config.lilypadCount - 1) * config.lilypadGap;
            const startX = Math.max(80, finishLineLeft - totalLilypadWidth - config.lilypadCount * 100);
            
            for (let i = 0; i < config.lilypadCount; i++) {
                // è®¡ç®—è·å¶å°ºå¯¸
                const lilypadSize = config.charLength === 2 ? 100 : (config.charLength === 3 ? 110 : 120);
                const lilypad = document.createElement('div');
                lilypad.className = `lilypad animate-target ${gameState.currentDifficulty}`;
                
                // ç”Ÿæˆéšæœºå­—ç¬¦
                const chars = generateRandomChars(config.charLength);
                
                // è®¡ç®—è·å¶ä½ç½®ï¼ˆå·¦åæ ‡ï¼‰ï¼ŒåŸºäºå½“å‰åç§»é‡
                const lilypadLeft = startX + i * config.lilypadGap + gameState.lilypadShiftX;
                // è®¡ç®—è·å¶ä¸­å¿ƒXåæ ‡ï¼ˆå…³é”®ï¼šç”¨äºé’è›™å®šä½ï¼‰
                const lilypadCenterX = lilypadLeft + lilypadSize / 2;
                
                lilypad.style.left = `${lilypadLeft}px`;
                lilypad.textContent = chars;
                
                domCache.gameContainer.appendChild(lilypad);
                
                // å­˜å‚¨è·å¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸­å¿ƒåæ ‡
                gameState.lilypads.push({
                    element: lilypad,
                    left: lilypadLeft,
                    centerX: lilypadCenterX, // ç¼“å­˜ä¸­å¿ƒåæ ‡
                    size: lilypadSize,
                    chars: chars
                });
            }
            
            // é«˜äº®ç¬¬ä¸€ä¸ªè·å¶
            if (gameState.lilypads.length > 0) {
                gameState.lilypads[0].element.classList.add('active');
            }
        }

        // ç”Ÿæˆéšæœºå­—ç¬¦
        function generateRandomChars(length) {
            let result = '';
            const chars = gameState.config.chars;
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * chars.length);
                result += chars[randomIndex];
            }
            return result;
        }

        // æ›´æ–°ç›®æ ‡å­—ç¬¦æ˜¾ç¤º
        function updateTargetChars() {
            if (gameState.currentLilypadIndex < gameState.lilypads.length) {
                gameState.targetChars = gameState.lilypads[gameState.currentLilypadIndex].chars;
                domCache.targetCharsEl.textContent = gameState.targetChars;
                domCache.inputPendingEl.textContent = '_'.repeat(gameState.targetChars.length);
            }
        }

        // é‡ç½®é’è›™ä½ç½® - ç²¾å‡†å®šä½åˆ°æŒ‡å®šè·å¶
        function resetFrogPosition(index = 0) {
            if (gameState.lilypads.length === 0) return;
            
            // è·å–ç›®æ ‡è·å¶çš„ä¸­å¿ƒåæ ‡
            const targetLilypad = gameState.lilypads[index];
            // è®¡ç®—é’è›™çš„Xåæ ‡ï¼šè·å¶ä¸­å¿ƒX - é’è›™å®½åº¦/2ï¼ˆè®©é’è›™å±…ä¸­åœ¨è·å¶ä¸Šï¼‰
            const frogTargetX = targetLilypad.centerX - gameState.frogWidth / 2;
            
            // ç›´æ¥è®¾ç½®é’è›™ä½ç½®ï¼Œæ— åŠ¨ç”»
            domCache.frog.style.transform = `translateX(${frogTargetX}px)`;
            // æ›´æ–°CSSå˜é‡ï¼Œç”¨äºåŠ¨ç”»
            domCache.frog.style.setProperty('--frog-x', `${frogTargetX}px`);
        }

        // ========== é‡æ„ï¼šç‹¬ç«‹çš„è¾“å…¥å¤„ç†å‡½æ•°ï¼ˆå…¼å®¹ç‰©ç†é”®ç›˜å’Œè™šæ‹Ÿé”®ç›˜ï¼‰ ==========
        function processKeyInput(key) {
            // æ¸¸æˆç»“æŸæˆ–æ— ç›®æ ‡å­—ç¬¦æ—¶ä¸å¤„ç†
            if (gameState.isGameOver || !gameState.targetChars) return;
            
            // å¼€å§‹è®¡æ—¶ï¼ˆé¦–æ¬¡è¾“å…¥ï¼‰
            if (!gameState.gameStarted) {
                gameState.gameStarted = true;
                gameState.startTime = Date.now();
                startTimer();
                domCache.gameTip.textContent = 'ç»§ç»­è¾“å…¥å­—ç¬¦å‰è¿›ï¼';
            }
            
            const inputKey = key.toUpperCase();
            
            // å¤„ç†åˆ é™¤é”®
            if (inputKey === 'BACKSPACE') {
                if (gameState.inputBuffer.length > 0) {
                    gameState.inputBuffer = gameState.inputBuffer.slice(0, -1);
                    const correctPart = gameState.targetChars.substring(0, gameState.inputBuffer.length);
                    const pendingLength = gameState.targetChars.length - gameState.inputBuffer.length;
                    
                    domCache.inputCorrectEl.textContent = gameState.inputBuffer;
                    domCache.inputPendingEl.textContent = '_'.repeat(pendingLength);
                }
                return;
            }
            
            // è¿‡æ»¤æ— æ•ˆå­—ç¬¦
            if (!gameState.config.chars.includes(inputKey)) return;
            
            gameState.totalInputs++;
            
            // æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®
            if (inputKey === gameState.targetChars[gameState.inputBuffer.length]) {
                // è¾“å…¥æ­£ç¡®
                gameState.correctInputs++;
                gameState.inputBuffer += inputKey;
                
                // æ›´æ–°è¾“å…¥ç¼“å†²åŒºæ˜¾ç¤º
                domCache.inputCorrectEl.textContent = gameState.inputBuffer;
                const pendingLength = gameState.targetChars.length - gameState.inputBuffer.length;
                domCache.inputPendingEl.textContent = '_'.repeat(pendingLength);
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆå½“å‰è·å¶çš„è¾“å…¥
                if (gameState.inputBuffer.length === gameState.targetChars.length) {
                    // æ ‡è®°å½“å‰è·å¶ä¸ºæ­£ç¡®
                    gameState.lilypads[gameState.currentLilypadIndex].element.classList.add('correct');
                    gameState.lilypads[gameState.currentLilypadIndex].element.classList.remove('active');
                    
                    // è·³è½¬åˆ°ä¸‹ä¸€ä¸ªè·å¶
                    gameState.currentLilypadIndex++;
                    domCache.stepCountEl.textContent = gameState.currentLilypadIndex;
                    
                    // é‡ç½®è¾“å…¥ç¼“å†²åŒº
                    gameState.inputBuffer = '';
                    domCache.inputCorrectEl.textContent = '';
                    
                    // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹
                    if (gameState.currentLilypadIndex >= gameState.config.lilypadCount) {
                        endGame(true);
                        return;
                    }
                    
                    // æ›´æ–°ç›®æ ‡å­—ç¬¦
                    updateTargetChars();
                    
                    // é’è›™è·³è·ƒåŠ¨ç”»
                    jumpToNextLilypad();
                    
                    // é«˜äº®ä¸‹ä¸€ä¸ªè·å¶
                    gameState.lilypads[gameState.currentLilypadIndex].element.classList.add('active');
                }
                
                // æ›´æ–°æ­£ç¡®ç‡å’Œé€Ÿåº¦
                updateAccuracy();
                updateSpeed();
            } else {
                // è¾“å…¥é”™è¯¯
                gameState.errorCount++;
                domCache.errorCountEl.textContent = gameState.errorCount;
                
                // æ˜¾ç¤ºé”™è¯¯åé¦ˆ
                showErrorFeedback();
                
                // æ›´æ–°æ­£ç¡®ç‡
                updateAccuracy();
                
                // æ£€æŸ¥æ˜¯å¦è¶…è¿‡æœ€å¤§é”™è¯¯æ¬¡æ•°
                if (gameState.errorCount >= gameState.config.maxErrors) {
                    endGame(false);
                    return;
                }
                
                // é’è›™åé€€åŠ¨ç”»
                frogBackAnimation();
            }
        }

        // é’è›™è·³è·ƒåˆ°ä¸‹ä¸€ä¸ªè·å¶
        function jumpToNextLilypad() {
            const targetLilypad = gameState.lilypads[gameState.currentLilypadIndex];
            const frogTargetX = targetLilypad.centerX - gameState.frogWidth / 2;
            
            // è®¾ç½®è·³è·ƒåŠ¨ç”»
            domCache.frog.style.setProperty('--frog-x', `${frogTargetX}px`);
            domCache.frog.classList.add('jump');
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤ç±»
            setTimeout(() => {
                domCache.frog.classList.remove('jump');
            }, 500);
        }

        // é’è›™åé€€åŠ¨ç”»
        function frogBackAnimation() {
            domCache.frog.classList.add('back');
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤ç±»
            setTimeout(() => {
                domCache.frog.classList.remove('back');
            }, 400);
        }

        // æ˜¾ç¤ºé”™è¯¯åé¦ˆ
        function showErrorFeedback() {
            domCache.errorFeedback.classList.add('show');
            
            // ç§»é™¤åé¦ˆ
            setTimeout(() => {
                domCache.errorFeedback.classList.remove('show');
            }, 1000);
        }

        // æ›´æ–°æ­£ç¡®ç‡
        function updateAccuracy() {
            if (gameState.totalInputs === 0) {
                domCache.accuracyEl.textContent = '100';
                return;
            }
            
            const accuracy = Math.round((gameState.correctInputs / gameState.totalInputs) * 100);
            domCache.accuracyEl.textContent = accuracy;
        }

        // æ›´æ–°æ‰“å­—é€Ÿåº¦ï¼ˆå­—ç¬¦/åˆ†é’Ÿï¼‰
        function updateSpeed() {
            if (!gameState.gameStarted || gameState.elapsedTime === 0) {
                domCache.speedEl.textContent = '0';
                return;
            }
            
            // è®¡ç®—ç”¨æ—¶ï¼ˆåˆ†é’Ÿï¼‰
            const minutes = gameState.elapsedTime / 60000;
            // è®¡ç®—é€Ÿåº¦ï¼ˆå­—ç¬¦/åˆ†é’Ÿï¼‰
            const speed = Math.round(gameState.correctInputs / minutes);
            domCache.speedEl.textContent = speed;
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            function updateTimer() {
                if (!gameState.gameStarted || gameState.isGameOver) return;
                
                gameState.elapsedTime = Date.now() - gameState.startTime;
                const minutes = Math.floor(gameState.elapsedTime / 60000);
                const seconds = Math.floor((gameState.elapsedTime % 60000) / 1000);
                
                // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                domCache.timeDisplayEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // æ›´æ–°é€Ÿåº¦
                updateSpeed();
                
                gameState.gameTimerId = requestAnimFrame(updateTimer);
            }
            
            updateTimer();
        }

        // ç»“æŸæ¸¸æˆ
        function endGame(isWin) {
            gameState.isGameOver = true;
            gameState.gameStarted = false;
            
            // åœæ­¢è®¡æ—¶å™¨
            if (gameState.gameTimerId) {
                cancelAnimFrame(gameState.gameTimerId);
                gameState.gameTimerId = null;
            }
            
            if (isWin) {
                // èƒœåˆ©
                domCache.finalTimeEl.textContent = domCache.timeDisplayEl.textContent;
                domCache.finalAccuracyEl.textContent = domCache.accuracyEl.textContent;
                domCache.finalSpeedEl.textContent = domCache.speedEl.textContent;
                
                domCache.overlay.classList.add('active');
                domCache.winModal.classList.add('active');
                domCache.winModal.style.display = 'block';
            } else {
                // å¤±è´¥
                domCache.loseTimeEl.textContent = domCache.timeDisplayEl.textContent;
                domCache.loseErrorsEl.textContent = gameState.errorCount;
                
                // è®¡ç®—å®Œæˆè¿›åº¦
                const progress = Math.round((gameState.currentLilypadIndex / gameState.config.lilypadCount) * 100);
                domCache.loseProgressEl.textContent = progress;
                
                domCache.overlay.classList.add('active');
                domCache.loseModal.classList.add('active');
                domCache.loseModal.style.display = 'block';
            }
        }

        // ========== æ–°å¢ï¼šAIæ”»ç•¥åŠ©æ‰‹å¤„ç†å‡½æ•° ==========
        function handleAiHelperQuery() {
            const query = domCache.aiHelperInput.value.trim();
            if (!query) return;
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            domCache.aiHelperInput.value = '';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            domCache.aiHelperResponse.innerHTML = '<div class="ai-helper-loading">æ­£åœ¨æ€è€ƒä¸­...</div>';
            
            // æ¨¡æ‹ŸAIæ€è€ƒå»¶è¿Ÿ
            setTimeout(() => {
                let answer = aiAnswers['é»˜è®¤å›ç­”'];
                
                // åŒ¹é…é—®é¢˜ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
                Object.keys(aiAnswers).forEach(key => {
                    if (query.includes(key) && key !== 'é»˜è®¤å›ç­”') {
                        answer = aiAnswers[key];
                    }
                });
                
                // æ˜¾ç¤ºå›ç­”ï¼ˆæ”¯æŒæ¢è¡Œï¼‰
                domCache.aiHelperResponse.textContent = answer;
            }, 800);
        }

        // äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // éš¾åº¦é€‰æ‹©
            domCache.difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    domCache.difficultyBtns.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ å½“å‰activeç±»
                    btn.classList.add('active');
                    
                    // æ›´æ–°æ¸¸æˆéš¾åº¦
                    gameState.currentDifficulty = btn.dataset.level;
                    gameState.config = difficultyConfig[gameState.currentDifficulty];
                    
                    // é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
                    initGame();
                });
            });

            // é‡æ–°å¼€å§‹æ¸¸æˆ
            domCache.resetBtn.addEventListener('click', initGame);
            domCache.winBtn.addEventListener('click', () => {
                domCache.overlay.classList.remove('active');
                domCache.winModal.classList.remove('active');
                initGame();
            });
            domCache.loseBtn.addEventListener('click', () => {
                domCache.overlay.classList.remove('active');
                domCache.loseModal.classList.remove('active');
                initGame();
            });

            // âœ… ä¿®å¤æ ¸å¿ƒ1ï¼šç§»é™¤å…¨å±€çš„e.preventDefault()ï¼Œæ”¹ä¸ºæŒ‰éœ€é˜»æ­¢ï¼Œä¸å½±å“è¾“å…¥æ¡†åŸç”Ÿè¡Œä¸º
            document.addEventListener('keydown', (e) => {
                // æ’é™¤AIè¾“å…¥æ¡†çš„æ‰€æœ‰é”®ç›˜è¡Œä¸ºï¼Œå®Œå…¨æ”¾è¡ŒåŸç”Ÿæ“ä½œï¼ˆé€€æ ¼/åˆ é™¤/è¾“å…¥/å…‰æ ‡éƒ½æœ‰æ•ˆï¼‰
                if (e.target === domCache.aiHelperInput) {
                    return;
                }
                // å¤„ç†åˆ é™¤é”®
                if (e.key === 'Backspace') {
                    processKeyInput('BACKSPACE');
                    e.preventDefault(); // åªé˜»æ­¢æ¸¸æˆç›¸å…³çš„é€€æ ¼é»˜è®¤è¡Œä¸º
                    return;
                }
                // å¤„ç†æ™®é€šå­—ç¬¦
                processKeyInput(e.key);
                e.preventDefault(); // åªé˜»æ­¢æ¸¸æˆç›¸å…³æŒ‰é”®çš„é»˜è®¤è¡Œä¸º
            });

            // è™šæ‹Ÿé”®ç›˜å¼€å…³
            domCache.keyboardToggleBtn.addEventListener('click', () => {
                gameState.keyboardVisible = !gameState.keyboardVisible;
                
                if (gameState.keyboardVisible) {
                    domCache.virtualKeyboard.classList.add('show');
                    domCache.keyboardToggleBtn.textContent = 'ğŸ“± éšè—è™šæ‹Ÿé”®ç›˜';
                } else {
                    domCache.virtualKeyboard.classList.remove('show');
                    domCache.keyboardToggleBtn.textContent = 'ğŸ“± æ˜¾ç¤ºè™šæ‹Ÿé”®ç›˜';
                }
            });

            // è™šæ‹Ÿé”®ç›˜æŒ‰é”®ç‚¹å‡»
            const keyboardKeys = document.querySelectorAll('.keyboard-key');
            keyboardKeys.forEach(key => {
                if (key.id === 'keyboard-backspace') {
                    key.addEventListener('click', () => processKeyInput('BACKSPACE'));
                } else {
                    key.addEventListener('click', () => processKeyInput(key.textContent));
                }
            });

            // ========== æ–°å¢ï¼šAIæ”»ç•¥åŠ©æ‰‹äº‹ä»¶ç›‘å¬ ==========
            // å‘é€æŒ‰é’®ç‚¹å‡»
            domCache.aiHelperSend.addEventListener('click', handleAiHelperQuery);
            
            // å›è½¦å‘é€
            domCache.aiHelperInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleAiHelperQuery();
                    e.preventDefault(); // åªé˜»æ­¢å›è½¦çš„é»˜è®¤è¡Œä¸º
                }
                // âœ… ä¿®å¤æ ¸å¿ƒ2ï¼šAIè¾“å…¥æ¡†çš„é€€æ ¼é”®å®Œå…¨æ”¾è¡Œï¼Œæ— ä»»ä½•é˜»æ­¢
            });
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            initGame();
            initEventListeners();
        });
    </script>
</body>
</html>
